<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>問題一覧</title>
  <style>
    .hidden { display: none; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #000000; border-bottom: none; background: #fcfcfc; }
    .tab.active { background: rgb(255, 255, 255); font-weight: bold; }
    .tab-content { border: 1px solid #aaa; padding: 15px; display: none; }
    .tab-content.active { display: block; }
    
  </style>
</head>

<body>
  <!-- ログインフォーム -->
  <div id="loginSection">
    <form id="loginForm">
      <h1>ログインページ</h1>
      <label>ユーザーID: <input type="text" name="userid" required></label><br>

      <label>パスワード: <input type="password" name="password" required></label><br>

      <button type="submit">ログイン</button>
    </form>
    <p id="loginMessage"></p>

    <p>新規登録は<a href='register_form.html'>こちら</a></p>
  </div>

  <!-- ログイン後に見える部分 -->
  <div id="mainSection" class="hidden">
    <h2 id="welcome"></h2>

  <button id="logoutBtn" style="margin:10px;">ログアウト</button>

    <p>初めての方は<a href="pre.html">こちら</a></p>
    <p>管理者の方は<a href="/admin">こちら</a></p>
    
    <!--タブ選択-->
    <div class="tabs">
      <div class="tab active" data-target="quiz">問題</div>
      <div class="tab" data-target="score">得点</div>
      <div class="tab" data-target="result_check">ランキング</div>
    </div>

  <!--タブの内容-->
  <div id="quiz" class="tab-content active">
    <div id="quizContainer"></div>

    <!-- モーダル -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <p><strong>得点:</strong> <span id="modal-point"></span> 点</p>
        <details>
          <summary>ヒント</summary>
          <div id="modal-hints"></div>
        </details>

        <!-- 🔽 ここにJSでファイルリンクを挿入 -->
        <div id="modal-files"></div>

        <hr>
        <input type="text" id="answer" placeholder="FLAG{...}">
        <button id="submitBtn">送信</button>
        <p id="result"></p>
      </div>
    </div>
  </div>

  <!--得点表示-->
  <div id="score" class="tab-content">
    <h2>得点</h2>
    <p id="scoreDisplay">現在の得点: -</p>
    <button id="scoreRefresh">最新スコア取得</button>

  </div>

  <!--ランキング表示-->
  <div id="result_check" class="tab-content">
    <h2>ランキング</h2>
    <table id="ranking">
    <thead>
      <tr><th>順位</th><th>ユーザー名</th><th>スコア</th></tr>
    </thead>
    <tbody>
        
    </tbody>
    </table>
    </div>
  </div>

    <!-- 省略: include xterm.js, socket.io -->
  <button id="start">Start Scenario</button>
  <div id="term"></div>

</body>
<script type="module" src="./js/main.js">
  document.getElementById('start').onclick = async () => {
    const res = await fetch('/start-sad', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({scenarioId:'sad01'})});
    const {instanceId, wsPath} = await res.json();
    const socket = io(wsPath);
    const term = new Terminal();
    term.open(document.getElementById('term'));
    term.onData(s => socket.emit('input', s));
    socket.on('output', data => term.write(data));
  };
</script>
</html>