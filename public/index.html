<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>å•é¡Œä¸€è¦§</title>
  <style>
    .hidden { display: none; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #000000; border-bottom: none; background: #fcfcfc; }
    .tab.active { background: rgb(255, 255, 255); font-weight: bold; }
    .tab-content { border: 1px solid #aaa; padding: 15px; display: none; }
    .tab-content.active { display: block; }
    
  </style>
</head>

<body>
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="loginSection">
    <form id="loginForm">
      <h1>ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸</h1>
      <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <input type="text" name="userid" required></label><br>

      <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <input type="password" name="password" required></label><br>

      <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>
    <p id="loginMessage"></p>

    <p>æ–°è¦ç™»éŒ²ã¯<a href='register_form.html'>ã“ã¡ã‚‰</a></p>
  </div>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¦‹ãˆã‚‹éƒ¨åˆ† -->
  <div id="mainSection" class="hidden">
    <h2 id="welcome"></h2>

  <button id="logoutBtn" style="margin:10px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

    <p>åˆã‚ã¦ã®æ–¹ã¯<a href="pre.html">ã“ã¡ã‚‰</a></p>
    <p>ç®¡ç†è€…ã®æ–¹ã¯<a href="/admin">ã“ã¡ã‚‰</a></p>
    
    <!--ã‚¿ãƒ–é¸æŠ-->
    <div class="tabs">
      <div class="tab active" data-target="quiz">å•é¡Œ</div>
      <div class="tab" data-target="score">å¾—ç‚¹</div>
      <div class="tab" data-target="result_check">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
    </div>

  <!--ã‚¿ãƒ–ã®å†…å®¹-->
  <div id="quiz" class="tab-content active">
    <div id="quizContainer"></div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <p><strong>å¾—ç‚¹:</strong> <span id="modal-point"></span> ç‚¹</p>
        <details>
          <summary>ãƒ’ãƒ³ãƒˆ</summary>
          <div id="modal-hints"></div>
        </details>

        <!-- ğŸ”½ ã“ã“ã«JSã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ã‚’æŒ¿å…¥ -->
        <div id="modal-files"></div>

        <hr>
        <input type="text" id="answer" placeholder="FLAG{...}">
        <button id="submitBtn">é€ä¿¡</button>
        <p id="result"></p>
      </div>
    </div>
  </div>

  <!--å¾—ç‚¹è¡¨ç¤º-->
  <div id="score" class="tab-content">
    <h2>å¾—ç‚¹</h2>
    <p id="scoreDisplay">ç¾åœ¨ã®å¾—ç‚¹: -</p>
    <button id="scoreRefresh">æœ€æ–°ã‚¹ã‚³ã‚¢å–å¾—</button>

  </div>

  <!--ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º-->
  <div id="result_check" class="tab-content">
    <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <table id="ranking">
    <thead>
      <tr><th>é †ä½</th><th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th><th>ã‚¹ã‚³ã‚¢</th></tr>
    </thead>
    <tbody>
        
    </tbody>
    </table>
    </div>
  </div>

    <!-- çœç•¥: include xterm.js, socket.io -->
  <button id="start">Start Scenario</button>
  <div id="term"></div>

</body>
<script type="module" src="./js/main.js">
  document.getElementById('start').onclick = async () => {
    const res = await fetch('/start-sad', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({scenarioId:'sad01'})});
    const {instanceId, wsPath} = await res.json();
    const socket = io(wsPath);
    const term = new Terminal();
    term.open(document.getElementById('term'));
    term.onData(s => socket.emit('input', s));
    socket.on('output', data => term.write(data));
  };
</script>
</html>