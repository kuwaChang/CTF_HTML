<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>問題一覧</title>
  <!-- Socket.io はサーバーから提供される -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <!-- xterm.js はCDN経由 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
  <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
  <!-- Leaflet（オープンソースの地図ライブラリ、APIキー不要） -->
  <!-- CSSとJSはquiz.jsで動的に読み込む -->
  <style>
    .hidden { display: none; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #000000; border-bottom: none; background: #fcfcfc; }
    .tab.active { background: rgb(255, 255, 255); font-weight: bold; }
    .tab-content { border: 1px solid #aaa; padding: 15px; display: none; }
    .tab-content.active { display: block; }
    
    /* sad server用のスタイル */
    #sad-terminal-container { margin-top: 20px; }
    #sad-scenario-select { 
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #5a5abf;
      border-radius: 6px;
      background-color: #2d3035;
      color: white;
    }
    #sad-start-btn {
      padding: 8px 16px;
      background-color: #0078ff;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      margin-bottom: 10px;
    }
    #sad-start-btn:hover { background-color: #005ecb; }
    #sad-terminal { width: 100%; height: 400px; background: #000; margin-top: 10px; }
  </style>
</head>

<body>
  <!-- ログインフォーム -->
  <div id="loginSection">
    <form id="loginForm">
      <h1>ログインページ</h1>
      <label>ユーザーID: <input type="text" name="userid" required></label><br>

      <label>パスワード: <input type="password" name="password" required></label><br>

      <button type="submit">ログイン</button>
    </form>
    <p id="loginMessage"></p>

    <p>新規登録は<a href='register_form.html'>こちら</a></p>
  </div>

  <!-- ログイン後に見える部分 -->
  <div id="mainSection" class="hidden">
    <h2 id="welcome"></h2>

  <button id="logoutBtn" style="margin:10px;">ログアウト</button>

    <p>初めての方は<a href="pre.html">こちら</a></p>
    <p>管理者の方は<a href="/admin">こちら</a></p>
    
    <!--タブ選択-->
    <div class="tabs">
      <div class="tab active" data-target="quiz">問題</div>
      <div class="tab" data-target="score">得点</div>
      <div class="tab" data-target="result_check">ランキング</div>
    </div>

  <!--タブの内容-->
  <div id="quiz" class="tab-content active">
    <div id="quizContainer"></div>

    <!-- モーダル -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <p><strong>得点:</strong> <span id="modal-point"></span> 点</p>
        <details>
          <summary>ヒント</summary>
          <div id="modal-hints"></div>
        </details>

        <!-- 🔽 ここにJSでファイルリンクを挿入 -->
        <div id="modal-files"></div>

        <!-- Sad Server用のターミナルコンテナ -->
        <div id="sad-terminal-container" style="display: none;">
          <label>
            難易度:
            <select id="sad-scenario-select">
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
            </select>
          </label>
          <button id="sad-start-btn">シナリオを開始</button>
          <div id="sad-terminal"></div>
        </div>

        <hr>
        
        <!-- 座標入力用の地図コンテナ -->
        <div id="map-container" style="display: none; margin: 15px 0;">
          <div id="map" style="width: 100%; height: 400px; border: 1px solid #ccc; border-radius: 5px;"></div>
          <div style="margin-top: 10px;">
            <p style="margin: 5px 0; font-size: 14px;">地図をクリックして座標を選択、または下の入力欄に直接座標を入力してください</p>
            <p id="selected-coords" style="margin: 5px 0; color: #0078ff; font-weight: bold;"></p>
          </div>
        </div>
        
        <input type="text" id="answer" placeholder="FLAG{...}">
        <button id="submitBtn">送信</button>
        <p id="result"></p>
        <div id="explanation-link" style="display: none; margin-top: 10px;">
          <a id="explanation-link-anchor" href="#" target="_blank" style="color: #0078ff; text-decoration: underline;">詳しい解説はこちら</a>
        </div>
      </div>
    </div>
  </div>

  <!--得点表示-->
  <div id="score" class="tab-content">
    <h2>得点</h2>
    <p id="scoreDisplay">現在の得点: -</p>
    <button id="scoreRefresh">最新スコア取得</button>

  </div>

  <!--ランキング表示-->
  <div id="result_check" class="tab-content">
    <h2>ランキング</h2>
    <table id="ranking">
    <thead>
      <tr><th>順位</th><th>ユーザー名</th><th>スコア</th></tr>
    </thead>
    <tbody>
        
    </tbody>
    </table>
    </div>
  </div>

</body>
<script type="module" src="./js/main.js"></script>
</html>