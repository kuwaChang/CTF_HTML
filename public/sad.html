<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Sad Server MVP</title>

  <!-- Socket.io はサーバーから提供される -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <!-- xterm.js はCDN経由 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
  <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>

  <style>
    body { background: #111; color: #fff; font-family: monospace; }
    #term { width: 100%; height: 500px; background: #000; margin-top: 10px; }
    button { padding: 8px 16px; background: #333; color: #fff; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Sad Server (MVP)</h2>
  <button id="start">Start Scenario</button>
  <div id="term"></div>

  <script>
    const term = new Terminal();
    term.open(document.getElementById('term'));

    document.getElementById('start').onclick = async () => {
      const res = await fetch("/sad/start-sad", { method: "POST" });
      const { wsPath } = await res.json();

      const socket = io("http://localhost:3333" + wsPath);
      term.write(`Connecting to ${wsPath}...\r\n`);

      socket.on("output", data => term.write(data));
      term.onData(input => socket.emit("input", input));

      socket.on("disconnect", () => {
        term.write("\r\n[Session ended]\r\n");
      });
    };
  </script>
</body>
</html>
