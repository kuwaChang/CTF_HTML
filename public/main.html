<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ログインページ</title>
  <style>
    .hidden { display: none; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #aaa; border-bottom: none; background: #eee; }
    .tab.active { background: white; font-weight: bold; }
    .tab-content { border: 1px solid #aaa; padding: 15px; display: none; }
    .tab-content.active { display: block; }
  </style>
  <link rel="stylesheet" href="main.css" type="text/css">
</head>

<body>
  <h1>ログインページ</h1>
  <!-- ログインフォーム -->
    <div id="loginSection">
      <form id="loginForm">
        <label>ユーザーID: <input type="text" name="userid" required></label><br>
        <label>パスワード: <input type="password" name="password" required></label><br>
        <button type="submit">ログイン</button>
      </form>
      <p id="loginMessage"></p>
      <p>新規登録は<a href="registser_form.html">こちら</a>から</p>
    </div>
      
  <!-- ログイン後に見える部分 -->
  <div id="mainSection" class="hidden">
    <h2 id="welcome"></h2>
    
    <!--タブ選択-->
    <div class="tabs">
      <div class="tab active" data-target="quiz">問題</div>
      <div class="tab" data-target="score">得点</div>
      <div class="tab" data-target="result_check">得点遷移</div>
    </div>

    <!--タブの内容-->
    <div id="quiz" class="tab-content active">
      <h2>Category</h2>
      <h3><a  target="_blank" href="web/web_top.html">web</a></h3>
      <h3>Crypto</h3>
      <h3>Pwn</h3>
      <h3>OSINT</h3>
    </div>

    <div id="score" class="tab-content">
      <h2>得点</h2>
      <p id="scoreDisplay">現在の得点: -</p>
      <button onclick="loadScore()">最新スコア取得</button>
    </div>

    <div id="result_check" class="tab-content">
      <h2>得点遷移</h2>
      <p>作ってる最中だよ</p>
    </div>
  </div>

  <script>
    // ログイン処理
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        userid: e.target.userid.value,
        password: e.target.password.value
      };

      const res = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const result = await res.json();

      if (result.success) {
        document.getElementById("loginMessage").innerText = "";
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("mainSection").classList.remove("hidden");
        document.getElementById("registerForm").classList.add("hidden");
        document.getElementById("welcome").innerText = "ようこそ " + result.username + " さん！";
      } else {
        document.getElementById("loginMessage").innerText = result.message;
      }
    });

    // タブ切り替え
    const tabs = document.querySelectorAll(".tab");
    const contents = document.querySelectorAll(".tab-content");
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.target).classList.add("active");
      });
    });

    // スコア読み込み
    async function loadScore() {
      const res = await fetch("/getScore");
      const result = await res.json();
      document.getElementById("scoreDisplay").innerText = "現在の得点: " + result.score;
    }
    // ここに /checkAnswer を呼ぶ処理も追加できる
  </script>
</body>
</html>
