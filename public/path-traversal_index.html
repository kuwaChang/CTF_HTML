<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ç·´ç¿’ç’°å¢ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .warning {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }

        .result.success {
            background: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }

        .result pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            color: #333;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .hint {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .hint h4 {
            color: #856404;
            margin-bottom: 8px;
        }

        .hint p {
            color: #856404;
            margin-bottom: 5px;
        }

        .example {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”“ ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ç·´ç¿’ç’°å¢ƒ</h1>
        
        <div class="warning">
            âš ï¸ ã“ã®ãƒšãƒ¼ã‚¸ã¯å­¦ç¿’ç›®çš„ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã®ã‚ˆã†ãªè„†å¼±æ€§ã‚’é˜²ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
        </div>

        <div class="section">
            <h2>ğŸ“š ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒã¨ã¯</h2>
            <div class="info-box">
                <h3>æ¦‚è¦</h3>
                <p>ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ï¼ˆPath Traversalï¼‰æ”»æ’ƒã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«å«ã¾ã‚Œã‚‹ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆ../ï¼‰ãªã©ã‚’åˆ©ç”¨ã—ã¦ã€æ„å›³ã—ãªã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ”»æ’ƒæ‰‹æ³•ã§ã™ã€‚</p>
            </div>
            <div class="info-box">
                <h3>æ”»æ’ƒã®ä»•çµ„ã¿</h3>
                <ul>
                    <li>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹éš›ã€é©åˆ‡ãªæ¤œè¨¼ã‚’è¡Œã‚ãªã„å ´åˆã«ç™ºç”Ÿ</li>
                    <li><code>../</code> ã‚’ä½¿ç”¨ã—ã¦è¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•</li>
                    <li>ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚„æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚‹</li>
                </ul>
            </div>
            <div class="info-box">
                <h3>å®Ÿéš›ã®äº‹ä¾‹</h3>
                <ul>
                    <li>2017å¹´: Equifaxã®ãƒ‡ãƒ¼ã‚¿ä¾µå®³ - ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«è„†å¼±æ€§ã‚’å«ã‚€è¤‡æ•°ã®è„†å¼±æ€§ãŒæ‚ªç”¨ã•ã‚Œã€1å„„4700ä¸‡äººã®å€‹äººæƒ…å ±ãŒæ¼æ´©</li>
                    <li>2019å¹´: è¤‡æ•°ã®CMSï¼ˆContent Management Systemï¼‰ã§ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«è„†å¼±æ€§ãŒç™ºè¦‹ã•ã‚Œã€æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã«</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ¯ ç·´ç¿’å•é¡Œ</h2>
            <p style="margin-bottom: 20px; color: #666;">
                ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
                é€šå¸¸ã®ãƒ•ã‚¡ã‚¤ãƒ«åã ã‘ã§ãªãã€ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
            </p>

            <div class="form-group">
                <label for="filePath">ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹:</label>
                <input type="text" id="filePath" placeholder="ä¾‹: ../flag.txt ã¾ãŸã¯ web/flag.png" value="">
                <div class="hint">
                    <h4>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</h4>
                    <p>é€šå¸¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: <code>web/flag.png</code></p>
                    <p>ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒ: <code>../flag.txt</code> ã‚„ <code>../../secret.txt</code></p>
                    <p>ç›®æ¨™: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ã‚ã‚‹ <code>flag.txt</code> ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¦ãã ã•ã„ï¼</p>
                </div>
            </div>

            <button onclick="downloadFile()">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

            <div id="result"></div>
        </div>

        <div class="section">
            <h2>ğŸ›¡ï¸ å¯¾ç­–æ–¹æ³•</h2>
            <div class="info-box">
                <h3>1. å…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º</h3>
                <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‹ã‚‰å±é™ºãªæ–‡å­—ï¼ˆ<code>../</code>ã€<code>..\\</code> ãªã©ï¼‰ã‚’å‰Šé™¤ã¾ãŸã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</p>
                <div class="example">
                    function sanitizePath(path) {<br>
                    &nbsp;&nbsp;return path.replace(/\.\./g, '').replace(/[^a-zA-Z0-9_/-]/g, '');<br>
                    }
                </div>
            </div>
            <div class="info-box">
                <h3>2. ãƒ‘ã‚¹ã®æ­£è¦åŒ–ã¨æ¤œè¨¼</h3>
                <p><code>path.resolve()</code> ã‚’ä½¿ç”¨ã—ã¦ãƒ‘ã‚¹ã‚’æ­£è¦åŒ–ã—ã€è¨±å¯ã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª</p>
                <div class="example">
                    const allowedDir = path.resolve('/safe/directory');<br>
                    const filePath = path.resolve(allowedDir, userInput);<br>
                    if (!filePath.startsWith(allowedDir)) {<br>
                    &nbsp;&nbsp;return error; // ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦<br>
                    }
                </div>
            </div>
            <div class="info-box">
                <h3>3. ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ–¹å¼</h3>
                <p>è¨±å¯ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«åã®ãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã€ãã‚Œä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦</p>
            </div>
        </div>
    </div>

    <script>
        async function downloadFile() {
            const filePath = document.getElementById('filePath').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!filePath) {
                resultDiv.innerHTML = '<div class="result error">ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">èª­ã¿è¾¼ã¿ä¸­...</div>';

            try {
                const url = `/path-traversal/download?file=${encodeURIComponent(filePath)}`;
                const response = await fetch(url);
                
                if (response.ok) {
                    // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯å†…å®¹ã‚’è¡¨ç¤º
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('text/')) {
                        const text = await response.text();
                        resultDiv.innerHTML = `
                            <div class="result success">
                                <strong>âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«æˆåŠŸã—ã¾ã—ãŸï¼</strong>
                                <p>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: <code>${filePath}</code></p>
                                <p>Content-Type: ${contentType}</p>
                                <pre>${escapeHtml(text)}</pre>
                            </div>
                        `;
                    } else {
                        // ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
                        const blob = await response.blob();
                        const downloadUrl = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = filePath.split('/').pop() || 'download';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(downloadUrl);
                        
                        resultDiv.innerHTML = `
                            <div class="result success">
                                <strong>âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«æˆåŠŸã—ã¾ã—ãŸï¼</strong>
                                <p>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: <code>${filePath}</code></p>
                            </div>
                        `;
                    }
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' }));
                    resultDiv.innerHTML = `
                        <div class="result error">
                            <strong>âŒ ã‚¨ãƒ©ãƒ¼: ${response.status}</strong>
                            <p>${errorData.error || 'ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ'}</p>
                            ${errorData.attemptedPath ? `<p>è©¦è¡Œã—ãŸãƒ‘ã‚¹: <code>${errorData.attemptedPath}</code></p>` : ''}
                            ${errorData.resolvedPath ? `<p>è§£æ±ºã•ã‚ŒãŸãƒ‘ã‚¹: <code>${errorData.resolvedPath}</code></p>` : ''}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="result error">
                        <strong>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</strong>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Enterã‚­ãƒ¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        document.getElementById('filePath').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                downloadFile();
            }
        });
    </script>
</body>
</html>

