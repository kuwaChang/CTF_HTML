<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="../style.css">
  <title>å•é¡Œä¸€è¦§</title>
  <!-- Socket.io ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <!-- xterm.js ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ« -->
  <link rel="stylesheet" href="../lib/xterm/xterm.css">
  <script src="../lib/xterm/xterm.min.js"></script>
  <!-- Chart.js for pie chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- Leafletï¼ˆã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®åœ°å›³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€APIã‚­ãƒ¼ä¸è¦ï¼‰ -->
  <!-- CSSã¨JSã¯quiz.jsã§å‹•çš„ã«èª­ã¿è¾¼ã‚€ -->
  <style>
    .hidden { display: none; }
    .tabs { display: flex; margin-bottom: 10px; }
    .tab { padding: 10px 20px; cursor: pointer; border: 1px solid #000000; border-bottom: none; background: #fcfcfc; }
    .tab.active { background: rgb(255, 255, 255); font-weight: bold; }
    .tab-content { border: 1px solid #aaa; padding: 15px; display: none; }
    .tab-content.active { display: block; }
    
    /* sad serverç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #sad-terminal-container { margin-top: 20px; }
    #sad-scenario-select { 
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #5a5abf;
      border-radius: 6px;
      background-color: #2d3035;
      color: white;
    }
    #sad-start-btn {
      padding: 8px 16px;
      background-color: #0078ff;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      margin-bottom: 10px;
    }
    #sad-start-btn:hover { background-color: #005ecb; }
    #sad-terminal { 
      width: 100%; 
      height: 400px; 
      background: #000; 
      margin-top: 10px;
      position: relative;
    }
    /* xterm.jsã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’è¡¨ç¤º */
    #sad-terminal .xterm-viewport {
      overflow-y: auto !important;
      overflow-x: hidden !important;
    }
    #sad-terminal .xterm-scroll-area {
      overflow-y: auto !important;
    }
    /* xterm.jsã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #sad-terminal .xterm-viewport::-webkit-scrollbar {
      width: 10px;
    }
    #sad-terminal .xterm-viewport::-webkit-scrollbar-track {
      background: #1e1e1e;
    }
    #sad-terminal .xterm-viewport::-webkit-scrollbar-thumb {
      background: #555;
      border-radius: 5px;
    }
    #sad-terminal .xterm-viewport::-webkit-scrollbar-thumb:hover {
      background: #777;
    }
  </style>
</head>

<body>
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="loginSection">
    <form id="loginForm">
      <h1>ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸</h1>
      <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <input type="text" name="userid" required></label><br>

      <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <input type="password" name="password" required></label><br>

      <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>
    <p id="loginMessage"></p>

    <p>æ–°è¦ç™»éŒ²ã¯<a href='register_form.html'>ã“ã¡ã‚‰</a></p>
  </div>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¦‹ãˆã‚‹éƒ¨åˆ† -->
  <div id="mainSection" class="hidden">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; position: relative;">
      <div style="width: 48px;"></div>
      <h2 id="welcome" style="margin: 0; flex: 1; text-align: center;"></h2>
      <a id="mypageIcon" href="/mypage" target="_blank" class="mypage-icon" title="ãƒã‚¤ãƒšãƒ¼ã‚¸" style="width: 48px;">
        <img id="userIconImg" src="" alt="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: none;">
        <span id="userIconDefault">ğŸ‘¤</span>
      </a>
    </div>

  <button id="logoutBtn" style="margin:10px;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>

    <p>åˆã‚ã¦ã®æ–¹ã¯<a href="/html/pre.html">ã“ã¡ã‚‰</a></p>
    <p>ç®¡ç†è€…ã®æ–¹ã¯<a href="/admin">ã“ã¡ã‚‰</a></p>
    
    <!--ã‚¿ãƒ–é¸æŠ-->
    <div class="tabs">
      <div class="tab active" data-target="quiz">å•é¡Œ</div>
      <div class="tab" data-target="score">å¾—ç‚¹</div>
      <div class="tab" data-target="result_check">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
      <div class="tab" data-target="achievements">å®Ÿç¸¾</div>
    </div>

  <!--ã‚¿ãƒ–ã®å†…å®¹-->
  <div id="quiz" class="tab-content active">
    <div id="quizContainer"></div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-title"></h2>
        <p id="modal-desc"></p>
        <p><strong>å¾—ç‚¹:</strong> <span id="modal-point"></span> ç‚¹</p>
        <details>
          <summary>ãƒ’ãƒ³ãƒˆ</summary>
          <div id="modal-hints"></div>
        </details>

        <!-- ğŸ”½ ã“ã“ã«JSã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ã‚’æŒ¿å…¥ -->
        <div id="modal-files"></div>

        <!-- Sad Serverç”¨ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div id="sad-terminal-container" style="display: none;">
          <label>
            é›£æ˜“åº¦:
            <select id="sad-scenario-select">
              <option value="easy1">Easy 1</option>
              <option value="easy2">Easy 2</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
              <option value="test1">Test 1</option>
            </select>
          </label>
          <button id="sad-start-btn">ã‚·ãƒŠãƒªã‚ªã‚’é–‹å§‹</button>
          <div id="sad-terminal"></div>
        </div>


        <hr>
        
        <!-- åº§æ¨™å…¥åŠ›ç”¨ã®åœ°å›³ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div id="map-container" style="display: none; margin: 15px 0;">
          <div id="map" style="width: 100%; height: 400px; border: 1px solid #ccc; border-radius: 5px;"></div>
          <div style="margin-top: 10px;">
            <p style="margin: 5px 0; font-size: 14px;">åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åº§æ¨™ã‚’é¸æŠã€ã¾ãŸã¯ä¸‹ã®å…¥åŠ›æ¬„ã«ç›´æ¥åº§æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            <p id="selected-coords" style="margin: 5px 0; color: #0078ff; font-weight: bold;"></p>
          </div>
        </div>
        
        <input type="text" id="answer" placeholder="FLAG{...}">
        <button id="submitBtn">é€ä¿¡</button>
        <p id="result"></p>
        <div id="explanation-link" style="display: none; margin-top: 10px;">
          <a id="explanation-link-anchor" href="#" target="_blank" style="color: #0078ff; text-decoration: underline;">è©³ã—ã„è§£èª¬ã¯ã“ã¡ã‚‰</a>
        </div>
      </div>
    </div>
  </div>

  <!--å¾—ç‚¹è¡¨ç¤º-->
  <div id="score" class="tab-content">
    <h2>å¾—ç‚¹</h2>
    <p id="scoreDisplay">ç¾åœ¨ã®å¾—ç‚¹: -</p>
    <p id="studyTimeDisplay">å­¦ç¿’æ™‚é–“: -</p>
    <button id="scoreRefresh">æœ€æ–°ã‚¹ã‚³ã‚¢å–å¾—</button>
    <div style="margin-top: 30px; text-align: center;">
      <h3>ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥è§£ç­”çŠ¶æ³</h3>
      <canvas id="categoryChart" style="max-width: 500px; max-height: 500px; margin: 0 auto; display: block;"></canvas>
    </div>
  </div>

  <!--ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º-->
  <div id="result_check" class="tab-content">
    <h2>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <table id="ranking">
    <thead>
      <tr><th>é †ä½</th><th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th><th>ã‚¹ã‚³ã‚¢</th></tr>
    </thead>
    <tbody>
        
    </tbody>
    </table>
  </div>

  <!--å®Ÿç¸¾è¡¨ç¤º-->
  <div id="achievements" class="tab-content">
    <h2>å®Ÿç¸¾</h2>
    <div id="achievementsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
      <!-- å®Ÿç¸¾ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
    </div>
  </div>
  </div>

</body>
<script type="module" src="../js/main.js"></script>
</html>