# Apache/Nginx サーバー設定ガイド

## 推奨: Nginx

このNode.jsアプリケーションには**Nginx**を推奨します。

### 理由
- ✅ 軽量で高パフォーマンス
- ✅ リバースプロキシとして優秀
- ✅ WebSocket（Socket.IO）のサポートが良好
- ✅ 設定がシンプル
- ✅ メモリ使用量が少ない

---

## Nginx セットアップ手順（Windows）

### 1. Nginxのダウンロードとインストール

1. [Nginx公式サイト](http://nginx.org/en/download.html)からWindows版をダウンロード
2. 解凍して `C:\nginx` に配置（任意の場所でも可）

### 2. 設定ファイルの配置

1. このディレクトリの `nginx.conf` をコピー
2. `C:\nginx\conf\nginx.conf` をバックアップ
3. コピーした `nginx.conf` を `C:\nginx\conf\nginx.conf` に配置
4. 必要に応じて設定を調整

### 3. Nginxの起動

```powershell
# Nginxの起動
cd C:\nginx
start nginx

# 設定ファイルの再読み込み
nginx -s reload

# Nginxの停止
nginx -s stop
```

### 4. 動作確認

- ブラウザで `http://localhost` にアクセス
- Node.jsアプリが正常に動作することを確認

### 5. ファイアウォール設定（必要に応じて）

```powershell
# ポート80を許可
New-NetFirewallRule -DisplayName "Nginx HTTP" -Direction Inbound -Protocol TCP -LocalPort 80 -Action Allow
```

---

## Apache セットアップ手順（Windows）

### 1. Apacheのダウンロードとインストール

1. [Apache Lounge](https://www.apachelounge.com/download/)からWindows版をダウンロード
2. 解凍して `C:\Apache24` に配置（任意の場所でも可）

### 2. 必要なモジュールの有効化

`C:\Apache24\conf\httpd.conf` を編集して、以下のモジュールのコメントを外す：

```apache
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
```

### 3. 設定ファイルの追加

1. このディレクトリの `apache.conf` の内容をコピー
2. `C:\Apache24\conf\extra\ctf.conf` として保存
3. `C:\Apache24\conf\httpd.conf` の最後に以下を追加：

```apache
Include conf/extra/ctf.conf
```

### 4. Apacheの起動

```powershell
# Apacheの起動
cd C:\Apache24\bin
.\httpd.exe -k start

# 設定ファイルの再読み込み
.\httpd.exe -k restart

# Apacheの停止
.\httpd.exe -k stop
```

### 5. 動作確認

- ブラウザで `http://localhost` にアクセス
- Node.jsアプリが正常に動作することを確認

---

## トラブルシューティング

### ポートが既に使用されている場合

- **Nginx**: `nginx.conf` の `listen 80;` を別のポート（例: `listen 8080;`）に変更
- **Apache**: `apache.conf` の `<VirtualHost *:80>` を `<VirtualHost *:8080>` に変更

### Node.jsアプリに接続できない場合

1. Node.jsアプリが `127.0.0.1:3333` で起動していることを確認
2. ファイアウォール設定を確認
3. ログファイルを確認：
   - Nginx: `C:\nginx\logs\error.log`
   - Apache: `C:\Apache24\logs\error.log`

### WebSocket（Socket.IO）が動作しない場合

- Nginx: `nginx.conf` の `/socket.io/` セクションを確認
- Apache: `mod_proxy_wstunnel` モジュールが有効になっているか確認

---

## パフォーマンス比較

| 項目 | Nginx | Apache |
|------|-------|--------|
| メモリ使用量 | 少ない | 多い |
| 同時接続数 | 多い | 中程度 |
| 設定の複雑さ | シンプル | やや複雑 |
| WebSocketサポート | 優秀 | 良好 |
| 静的ファイル配信 | 高速 | 高速 |

---

## 次のステップ

- SSL/TLS証明書の設定（HTTPS化）
- ログローテーションの設定
- レート制限の設定
- キャッシュの設定

